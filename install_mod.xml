<?xml version="1.0" encoding="UTF-8" standalone="yes"?> 
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?> 
<!--NOTICE: Please open this file in your web browser. If presented with a security warning, you may safely tell it to allow the blocked content.--> 
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD.\nAlthough MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD.\nNo support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/--> 
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd"> 
	<header> 
		<meta name="generator" content="MODX file generated with PP MODX Creator by tumba25 (online version)"/> 
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license> 
		<title lang="en"><![CDATA[Alternate Login]]></title> 
		<description lang="en"><![CDATA[Enable users to log in to a phpBB board via another website authentication method and synchronise profile information.  Currently available: Facebook, Twitter and Windows Live]]></description> 
		<author-notes lang="en"><![CDATA[This is an RC version.  It has been tested on various servers but only a handful of users.]]></author-notes> 
		<author-group> 
			<author> 
				<realname><![CDATA[Michael J Goonawardena]]></realname> 
				<username><![CDATA[Mjimeyg]]></username> 
				<homepage><![CDATA[http://www.consof.com]]></homepage> 
				<email><![CDATA[michaelgoonawardena@googlemail.com]]></email> 
			</author> 
                        
                        <author>
                            <username>ExpoFrontier</username>
                            <contributions-group>
                                <contributions status="current" from="26-01-2021" position="Translator"></contributions>
                            </contributions-group>
                        </author>
						
						<author>
							<username>the_zoker_09</username>
							<contributions-group>
								<contributions status="current" from="17-06-2012" position="Translator"></contributions>
							</contributions-group>
						</author>
		</author-group> 
                <link-group>
					<link type="language" href="root/contrib/language/de/" lang="en">German Language Template</link>
                    <link type="contrib" href="root/contrib/install_mod_update_2012.02.12.01-2012.02.14.01.xml" lang="en">Update file from version 2012.02.12.01</link>
					<link type="contrib" href="root/contrib/install_mod_update_2012.03.13.03-2012.02.14.01.xml" lang="en">Update file from version 2012.03.13.03</link>
					<link type="contrib" href="root/contrib/install_mod_update_2012.04.26.01-2012.05.13.01.xml" lang="en">Update file from version 2012.04.26.01</link>
					<link type="contrib" href="root/contrib/install_mod_update_2012.05.13.01-2012.05.23.01.xml" lang="en">Update file from version 2012.05.13.01</link>
                </link-group>
		<mod-version>2012.08.26.01</mod-version> 
		<installation> 
			<level>intermediate</level> 
			<time>960</time> 
			<target-version>3.0.10</target-version> 
		</installation> 
                <history>
					<entry>
                        <date>2012.08.26</date>
                        <rev-version>2012.07.05.01</rev-version>
                        <changelog lang="en">
							<change>alternatelogin_mod_install.php: Updated version number and replaced ucp mode twitter with main.</change>
							<change>includes/ucp/info/ucp_alternatelogin.php: Replaced three seperate modes with one.</change>
							<change>includes/ucp/ucp_alternatelogin.php: Removed submit code for deprecated unlinking code and added linking options and consolidated profile syncing options.</change>
							
                            <change>root/contrib/languages/de : German template translations added.</change>
							
							<change>styles/subsilver2/template/ucp_altenatelogin.html : Added linking options and consolidated profile syncing options.</change>
							<change>styles/prosilver/template/ucp_altenatelogin.html : Added linking options.</change>
							<change>styles/subsilver2/template/index_body.html : Added missing Facebook Like button.</change>
							<change>styles/subsilver2/template/ucp_register.html : Removed old code to hide password fields.</change>
							<change>alternatelogin/al_wl_connect.php : Removed requirement for anonymous user to process the auth code and added account linking option.</change>
							<change>alternatelogin/al_fb_connect.php : Added account linking option.</change>
                        </changelog>
                    </entry>
					<entry>
                        <date>2012.06.22</date>
                        <rev-version>2012.06.22.01</rev-version>
                        <changelog lang="en">
                            <change>styles/prosilver/template/facebook_registration.html : Removed Location field from form.</change>
							<change>styles/subsilver2/template/facebook_registration.html : Removed Location field from form.</change>
                        </changelog>
                    </entry>
					<entry>
                        <date>2012.06.07</date>
                        <rev-version>2012.06.07.01</rev-version>
                        <changelog lang="en">
							<change>includes/ucp/ucp_profile.php : Added function_exists call to check before including functions_alternatelogin.php file.</change>
                        </changelog>
                    </entry>
					<entry>
                        <date>2012.05.28</date>
                        <rev-version>2012.05.28.01</rev-version>
                        <changelog lang="en">
                            <change>includes/functions_alternatelogin.php : Added argument to add_log function calls.</change>
                        </changelog>
                    </entry>
					<entry>
                        <date>2012.05.25</date>
                        <rev-version>2012.05.25.01</rev-version>
                        <changelog lang="en">
                            <change>includes/ucp/info/ucp_alternatelogin.php : Replaced AL_CONSOF language keys with SOCIAL_LOGIN_OPTIONS key.</change>
                        </changelog>
                    </entry>
					<entry>
                        <date>2012.05.23</date>
                        <rev-version>2012.05.23.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_connect.php : Removed lines 467 - 481 and corresponding if brackets.  COPPA and email registration not required for quick accounts.</change>
                        </changelog>
                    </entry>
					<entry>
                        <date>2012.05.13</date>
                        <rev-version>2012.05.13.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_connect.php : Reversed the lines at 57 and 58 to strip relative path from $return_to_page.</change>
                            <change>styles/prosilver/openid-en.js : Added entry for Steam.</change>
							<change>styles/subsilver2/openid-en.js : Added entry for Steam.</change>
							<change>styles/prosilver/openid-jquery.js : Changed value of 'no_sprite' to true.</change>
							<change>styles/subsilver2/openid-jquery.js : Changed value of 'no_sprite' to true.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012.04.26</date>
                        <rev-version>2012.04.26.01</rev-version>
                        <changelog lang="en">
                            <change>styles/prosilver/template/index_body.html : Added missing AL_FB_LIKE_BOX variable to first IF statement.</change>
                            <change>styles/subsilver2/template/index_body.html : Added missing AL_FB_LIKE_BOX variable to first IF statement.</change>
                            <change>styles/prosilver/template/login_body.html : Moved Alternate Login buttons outside of login form to fix conflict with OI.</change>
                            <change>styles/subsilver2/template/login_body.html : Moved Alternate Login buttons outside of login form to fix conflict with OI.</change>
                            <change>styles/prosilver/template/login_body.html : Added Redirect variable to login urls.</change>
                            <change>styles/subsilver2/template/login_body.html : Added Redirect variable to login urls.</change>
                            <change>functions.php : Added template variable to assign redirect to login urls.</change>
                            <change>functions_alternatelogin.php : Edited get_fb_access_token() function to pass redirect url.</change>
                            <change>adm/index.php : Removed alterations to the file.  File now remains unchanged on install.</change>
                            <change>al_fb_connect.php : Added meta_refresh function call to redirect after successful login and pass redirect page through authentication.</change>
                            <change>al_oi_connect.php : Added meta_refresh function call to redirect after successful login.</change>
                            <change>al_tw_connect.php : Added meta_refresh function call to redirect after successful login.</change>
                            <change>al_wl_connect.php : Added meta_refresh function call to redirect after successful login.</change>
                            <change>includes/acp/acp_alternatelogin.php : Added function call to Facebook settings to increase max_name_chars if Quick Accounts is enabled.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012.03.13</date>
                        <rev-version>2012.02.15.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_connect.php : Completely overhauled.</change>
                            <change>al_oi_connect.php : Completely overhauled.</change>
                            <change>al_tw_connect.php : Completely overhauled.</change>
                            <change>al_wl_connect.php : Completely overhauled.</change>
                            <change>facebook_registration : Added password fields.</change>
                            <change>ucp_register.php : Removed alteration of passwords.</change>
                            <change>ucp_register.html : Removed changes to password fields.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012.02.14</date>
                        <rev-version>2012.02.15.01</rev-version>
                        <changelog lang="en">
                            <change>styles/prosilver/template/images.large/steam.gif : Added Steam image.</change>
                            <change>styles/prosilver/template/js/openid-uk.js : Added Steam Provider.</change>
                            <change>functions_alternatelogin.php : corrected all add_log function calls.</change>
                            <change>functions_alternatelogin.php : Added 'global $user' declaration to get_fb_data() function.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-02-12</date>
                        <rev-version>2012.02.12.01</rev-version>
                        <changelog lang="en">
                            <change>functions_alternatelogin.php : Replaced AL_MYSPACE_LOGIN and AL_MYSPACE_PROFILE constants with AL_OPENID_LOGIN and AL_OPENID_PROFILE respectively.</change>
                            <change>includes/acp/acp_alternatelogin.php : Added code to retrieve and set al_oi_login database entry.</change>
                            <change>al_oi_connect.php : Added file to handle OpenID accounts.</change>
                            <change>alternatelogin/openid/openid.php : Added 3rd party OpenID library.</change>
                            <change>acp_alternatelogin.html : Added radio buttons for OpenID.</change>
                            <change>styles/prosilver/template/index_body.php : Added OpenID login code.</change>
                            <change>styles/subsilver2/template/index_body.php : Added OpenID login code.</change>
                            <change>styles/prosilver/template/login_body.php : Added OpenID login code.</change>
                            <change>styles/subsilver2/template/login_body.php : Added OpenID login code.</change>
                            <change>info_acp_alternatelogin.php : Added entries for OPENID.</change>
                            <change>info_ucp_alternatelogin.php : Added entries for OPENID.</change>
                            <change>al_oi_auth.php : Added file to handle OpenID authentication.</change>
                            <change>Added Google OpenID Selector directories to prosilver and subsilver2 directories.</change>
                            <change>functions.php : Added style variable U_AL_OI_LOGIN to page_header function.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-27</date>
                        <rev-version>2012.01.27.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_register.php : Replaced 3.0.9 anti-abuse header code with 3.0.10 code at line 277 (approx.)</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-25</date>
                        <rev-version>2012.01.25.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_connect.php : Replaced $db->sql_fetchrow with $db->sql_fetchfield at line 250.</change>
                            <change>al_tw_connect.php : Removed include for tmhUtilities class.</change>
                            <change>al_tw_connect.php : Replaced call to tmhUtilities::php_self with php_self function.</change>
                            <change>functions_alternatelogin.php : Added php_self function from tmhUtilities class.</change>
                            <change>ucp_register.php : Removed include for tmhUtilities.php.</change>
                            <change>ucp_register.php : Removed include for tmhUtilities.php.</change>
                            <change>al_wl_connect.php : Changed include_once to include.</change>
                            <change>al_fb_connect.php : Changed include_once to include.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-20</date>
                        <rev-version>2012.01.20.01</rev-version>
                        <changelog lang="en">
                            <change>styles/prosilver/template/index_body.html : Altered style aesthetics for Social Login buttons.</change>
                            <change>styles/prosilver/template/login_body.html : Altered style aesthetics for Social Login buttons.</change>
                            <change>al_fb_connect.php : Added database call to check if email address is already in use.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-15</date>
                        <rev-version>2012.01.15.01</rev-version>
                        <changelog lang="en">
                            <change>al_wl_connect.php : Added boolean checks to Windows Live profile values on lines 196 and 197.</change>
                            <change>al_tw_connect.php : Added boolean checks to Twitter profile values on lines 239 and 241.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-14</date>
                        <rev-version>2012.01.14.01</rev-version>
                        <changelog lang="en">
                            <change>ucp_profile.php : Added boolean checks to Windows Live profile values on lines 357 and 358 (approx.)</change>
                            <change>ucp_profile.php : Added boolean checks to Twitter profile values on lines 364 and 365 (approx.)</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-11</date>
                        <rev-version>2012.01.11.01</rev-version>
                        <changelog lang="en">
                            <change>al_tw_connect.php : Fixed miss use of variable '$tw_data' to '$tw_user' at line 340.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2012-01-02</date>
                        <rev-version>2012.01.02.01</rev-version>
                        <changelog lang="en">
                            <change>alternatelogin_mod_install.php : Added SQL entry for field: al_fb_hide_like_box.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-12-21</date>
                        <rev-version>2011.12.21.01</rev-version>
                        <changelog lang="en">
                            <change>functions_alternatelogin.php : replaced 'script' call with $template calls.</change>
                            <change>prosilver/template/al_redirect.html :  Created the file as template to handle required redirects.</change>
                            <change>subsilver2/template/al_redirect.html :  Created the file as template to handle required redirects.</change>
                            <change>functions_alternatelogin.php : Replaced $_REQUEST call with request_var call.</change>
                            <change>acp_alternatelogin.php : Replaced include_once with file_exists check.</change>
                            <change>acp_alternatelogin.php : Replaced $_SERVER call with ''.</change>
                            <change>acp_alternatelogin.html : Added form elements to enable and display a Facebook Like Box.</change>
                            <change>info_acp_alternatelogin.php : Added entries for FACEBOOK_PAGE_URL and FACEBOOK_LIKE_BOX.</change>
                            <change>functions.php : Added template entries for Facebook Like Box and Facebook Page Url.</change>
                            <change>prosilver/template/index_body.html : Facebook Like Box code.</change>
                            <change>subsilver2/template/index_body.html : Facebook Like Box code.</change>
                            <change>prosilver/template/ucp_prefs_personal.html : Added form elements for user to hide Facebook Like Box.</change>
                            <change>subsilver2/template/ucp_prefs_personal.html : Added form elements for user to hide Facebook Like Box.</change>
                            <change>ucp_prefs.php : Added code to handle user hiding Facebook Like Box.</change>
                            <change>info_ucp_alternatelogin.php : Added entries for AL_FB_HIDE_LIKE_BOX.</change>
                            <change>subsilver2/template/index_body.html : Added code for Facebook Like Box.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-12-16</date>
                        <rev-version>2011.12.16.01</rev-version>
                        <changelog lang="en">
                            <change>ucp_register.php : Altered $template->assign_vars entry 'S_AL_TW_ENABLED' to 'S_AL_TW_USER and added boolean check to see if user is a twitter user.</change>
                            <change>ucp_register.html : Changed 'S_AL_TW_ENABLED' if statement to use 'S_AL_TW_USER'.</change>
                            <change>al_tw_connect.php : Added reques_token to oauth/access_token call.</change>
                            <change>ucp_register.php : Altered Twitter $data['email_confirm'] to use the $data['email'] as value.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-12-14</date>
                        <rev-version>2011.12.14.01</rev-version>
                        <changelog lang="en">
                            <change>functions_alternatelogin.php : Added 'email' to permissions list in get_fb_access_token() function.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-11-29</date>
                        <rev-version>2011.11.29.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_register.php : Removed duplicate include call.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-11-28</date>
                        <rev-version>2011.11.28.02</rev-version>
                        <changelog lang="en">
                            <change>al_fb_register.php : Removed an invalid add_lang function call.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-11-28</date>
                        <rev-version>2011.11.28.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_registration.php : Corrected the initialisation of the variable $agreed and included a check to make sure it is true otherwise to return to index.php.</change>
                            <change>info_ucp_alternatelogin.php : Added language entry for trigger_error call to inform existing users how to link their accounts.</change>
                        </changelog>
                    </entry>
                    <entry>
                        <date>2011-11-22</date>
                        <rev-version>2011.11.22.01</rev-version>
                        <changelog lang="en">
                            <change>al_fb_registration.php : Corrected the initialisation of the variable $agreed and included a check to make sure it is true otherwise to return to index.php.</change>
                        </changelog>
                    </entry>
                </history>
	</header> 
	<action-group> 
		<sql><![CDATA[ALTER TABLE  `phpbb_sessions` ADD  `session_wl_access_token` LONGTEXT NULL ,
ADD  `session_tw_access_token` LONGTEXT NULL]]></sql> 
		<copy> 
			<file from="root/alternatelogin/*.*" to="alternatelogin/*.*"/> 
			<file from="root/adm/style/acp_alternatelogin.html" to="adm/style/acp_alternatelogin.html"/> 
			<file from="root/includes/functions_alternatelogin.php" to="includes/functions_alternatelogin.php"/> 
			<file from="root/includes/acp/acp_alternatelogin.php" to="includes/acp/acp_alternatelogin.php"/> 
			<file from="root/includes/acp/info/acp_alternatelogin.php" to="includes/acp/info/acp_alternatelogin.php"/> 
			<file from="root/includes/ucp/ucp_alternatelogin.php" to="includes/ucp/ucp_alternatelogin.php"/> 
			<file from="root/includes/ucp/info/ucp_alternatelogin.php" to="includes/ucp/info/ucp_alternatelogin.php"/> 
			<file from="root/language/en/mods/info_acp_alternatelogin.php" to="language/en/mods/info_acp_alternatelogin.php"/> 
			<file from="root/language/en/mods/info_ucp_alternatelogin.php" to="language/en/mods/info_ucp_alternatelogin.php"/> 
			<file from="root/language/en/email/admin_welcome_inactive_alternatelogin.txt" to="language/en/email/admin_welcome_inactive_alternatelogin.txt"/> 
			<file from="root/language/en/email/coppa_welcome_inactive_alternatelogin.txt" to="language/en/email/coppa_welcome_inactive_alternatelogin.txt"/> 
			<file from="root/language/en/email/user_welcome_alternatelogin.txt" to="language/en/email/user_welcome_alternatelogin.txt"/> 
			<file from="root/language/en/email/user_welcome_inactive_alternatelogin.txt" to="language/en/email/user_welcome_inactive_alternatelogin.txt"/> 
			<file from="root/styles/subsilver2/*.*" to="styles/subsilver2/template/*.*"/> 
			<file from="root/styles/prosilver/template/*.*" to="styles/prosilver/template/*.*"/> 
			<file from="root/*.*" to="*.*"/> 
		</copy> 
		<open src="viewtopic.php"> 
			<edit> 
				<find><![CDATA['U_TOPIC'				=> "{$server_path}viewtopic.$phpEx?f=$forum_id&amp;t=$topic_id",]]></find> 
				<action type="before-add"><![CDATA['U_PAGE_URL'                    => generate_board_url() . "/viewtopic.$phpEx?f=$forum_id&amp;t=$topic_id",]]></action> 
			</edit> 
		</open> 
		
		<open src="includes/functions.php"> 
			<edit> 
				<find><![CDATA[    if (strpos($user_lang, '-x-') !== false)
	{
		$user_lang = substr($user_lang, 0, strpos($user_lang, '-x-'));
	}
]]></find> 
				<action type="after-add"><![CDATA[        // Begin Alternate Login code
        require_once('functions_alternatelogin.php'); // Include the functions for Alternate Login module
        $user->add_lang('mods/info_ucp_alternatelogin');
        if($user->data['session_fb_access_token'])
        {
            $graph_url = "https://graph.facebook.com/me?" . $user->data['session_fb_access_token'];


            $fb_user = json_decode(get_fb_data($graph_url));
            
            $fb_lang = $fb_user->locale;
        }
        ]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['SITENAME'						=> $config['sitename'],]]></find> 
				<action type="after-add"><![CDATA[		'S_AL_FB_ENABLED'				=> isset($config['al_fb_login']) ? $config['al_fb_login'] : false,
		'S_AL_TW_ENABLED'				=> isset($config['al_tw_login']) ? $config['al_tw_login'] : false,
		'S_AL_WL_ENABLED'				=> isset($config['al_wl_login']) ? $config['al_wl_login'] : false,
                'S_AL_OI_ENABLED'                               => isset($config['al_oi_login']) ? $config['al_oi_login'] : false,
		'S_AL_WL_USER'					=> isset($user->data['al_wl_id']) ? $user->data['al_wl_id'] : false,
                'S_AL_FB_USER'                                  => isset($user->data['al_fb_id']) ? $user->data['al_fb_id'] : false,
                'S_AL_TW_USER'                                  => isset($user->data['al_tw_id']) ? $user->data['al_tw_id'] : false,
				'S_AL_OI_USER'                                  => isset($user->data['al_oi_id']) ? $user->data['al_oi_id'] : false,
		'AL_FB_APPID'					=> isset($config['al_fb_id']) ? $config['al_fb_id'] : false,
                'AL_FB_SITE_DOMAIN'                             => isset($config['al_site_domain']) ? $config['al_site_domain'] : false,
                'AL_FB_ACTIVITY'                                => isset($config['al_fb_activity']) ? $config['al_fb_activity'] : false,
                'AL_FB_FACEPILE'                                => isset($config['al_fb_facepile']) ? $config['al_fb_facepile'] : false,
                'AL_FB_STREAM'                                  => isset($config['al_fb_stream']) ? $config['al_fb_stream'] : false,
                'AL_FB_LIKE_BOX'                                => isset($config['al_fb_like_box']) ? $config['al_fb_like_box'] : false,
		'S_AL_WL_CLIENT_ID'				=> isset($config['al_wl_client_id']) ? $config['al_wl_client_id'] : false,
                'S_AL_WL_WRAP_CALLBACK'                         => isset($config['al_wl_callback']) ? $config['al_wl_callback'] : false,
                'S_AL_WL_WRAP_CHANNEL'                          => isset($config['al_wl_channel']) ? $config['al_wl_channel'] : false,
                'AL_FB_APP_ID'                                  => isset($config['al_fb_id']) ? $config['al_fb_id'] : false,
                'AL_FB_PAGE_URL'                                => isset($config['al_fb_page_url']) ? $config['al_fb_page_url'] : false,
                'FB_APP_ID'                                     => isset($config['al_fb_id']) ? $config['al_fb_id'] : false,
                'AL_FB_USER_HIDE_ACTIVITY'                      => isset($user->data['al_fb_hide_activity']) ? $user->data['al_fb_hide_activity'] : false,
                'AL_FB_USER_HIDE_STREAM'                        => isset($user->data['al_fb_hide_stream']) ? $user->data['al_fb_hide_stream'] : false,
                'AL_FB_USER_HIDE_FACEPILE'                      => isset($user->data['al_fb_hide_facepile']) ? $user->data['al_fb_hide_facepile'] : false,
                'AL_FB_USER_HIDE_LIKE_BOX'                      => isset($user->data['al_fb_hide_like_box']) ? $user->data['al_fb_hide_like_box'] : false,
                'U_AL_WL_AUTHORIZE'                             => "https://oauth.live.com/authorize?client_id={$config['al_wl_client_id']}&scope=wl.signin%20wl.basic%20wl.birthday%20wl.emails%20wl.work_profile%20wl.postal_addresses&response_type=code&redirect_uri=" . urlencode($config['al_wl_callback']),
                'U_AL_TW_REQUEST'                               => "{$phpbb_root_path}alternatelogin/al_tw_connect.{$phpEx}?authentication=1",
                'U_AL_OI_LOGIN'                                 => "{$phpbb_root_path}alternatelogin/al_oi_auth.{$phpEx}",
                'S_FB_LOCALE'                                   => ($fb_lang) ? $fb_lang : 'en_GB',
                'S_RETURN_TO_PAGE'                              => "?return_to_page=" . base64_encode(build_url()),]]></action> 
			</edit> 
		</open> 
		<open src="includes/ucp/ucp_prefs.php"> 
			<edit> 
				<find><![CDATA[add_form_key('ucp_prefs_personal');]]></find> 
				<action type="after-add"><![CDATA[                                $user->add_lang('mods/info_ucp_alternatelogin');]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['allowpm'		=> request_var('allowpm', (bool) $user->data['user_allow_pm']),]]></find> 
				<action type="after-add"><![CDATA[                                    'hide_al_fb_activity'   => request_var('al_fb_activity', $user->data['al_fb_hide_activity']),
                                        'hide_al_fb_stream'     => request_var('al_fb_stream', $user->data['al_fb_hide_stream']),
                                        'hide_al_fb_facepile'   => request_var('al_fb_facepile', $user->data['al_fb_hide_facepile']),
                                        'hide_al_fb_like_box'   => request_var('al_fb_like_box', $user->data['al_fb_hide_like_box']),]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['user_style'			=> $data['style'],]]></find> 
				<action type="after-add"><![CDATA[                          
                                                        'al_fb_hide_activity'           => $data['hide_al_fb_activity'],
                                                        'al_fb_hide_stream'             => $data['hide_al_fb_stream'],
                                                        'al_fb_hide_facepile'           => $data['hide_al_fb_facepile'],
                                                        'al_fb_hide_like_box'           => $data['hide_al_fb_like_box'],]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['S_SELECT_NOTIFY'		=> ($config['jab_enable'] && $user->data['user_jabber'] && @extension_loaded('xml')) ? true : false)]]></find> 
				<action type="replace-with"><![CDATA[                                        'S_SELECT_NOTIFY'		=> ($config['jab_enable'] && $user->data['user_jabber'] && @extension_loaded('xml')) ? true : false,
                                        
                                        'AL_FB_ACTIVITY'                => $config['al_fb_activity'],
                                        'AL_FB_STREAM'                  => $config['al_fb_stream'],
                                        'AL_FB_FACEPILE'                => $config['al_fb_facepile'],
                                        'AL_FB_LIKE_BOX'                => $config['al_fb_like_box'],
                                        'S_AL_FB_HIDE_ACTIVITY'         => $data['hide_al_fb_activity'],
                                        'S_AL_FB_HIDE_STREAM'           => $data['hide_al_fb_stream'],
                                        'S_AL_FB_HIDE_FACEPILE'         => $data['hide_al_fb_facepile'],
                                        'S_AL_FB_HIDE_LIKE_BOX'         => $data['hide_al_fb_like_box'],)
                                        
				]]></action> 
			</edit> 
		</open> 
		<open src="includes/ucp/ucp_profile.php"> 
			<edit> 
				<find><![CDATA[include($phpbb_root_path . 'includes/functions_profile_fields.' . $phpEx);]]></find> 
				<action type="after-add"><![CDATA[                                include($phpbb_root_path . 'includes/functions_alternatelogin.' . $phpEx);
                                
                                $fb_sync = (request_var('fb_sync', '') == 'on') ? 1 : 0;
                                $wl_sync = (request_var('wl_sync', '') == 'on') ? 1 : 0;
                                $tw_sync = (request_var('tw_sync', '') == 'on') ? 1 : 0;
                                
                                $user_data = array();
                                if($user->data['al_fb_id'])
                                {
                                    $graph_url = "https://graph.facebook.com/me?" . $user->data['session_fb_access_token'];
 
                                    $fb_user = json_decode(get_fb_data($graph_url));
                                }
                                
                                if($user->data['al_wl_id'])
                                {
                                    $wl_user = get_wl_rest_request($user->data['session_wl_access_token'], 'me', HTTP_GET);
                                    
                                    if(isset($wl_user->addresses->personal->city) && isset($wl_user->addresses->personal->region))
                                    {
                                        $user_locale = $wl_user->addresses->personal->city . ', ' . $wl_user->addresses->personal->region;
                                        
                                    }
                                    elseif(isset($wl_user->addresses->personal->city))
                                    {
                                        $user_locale = $wl_user->addresses->personal->city;
                                        
                                    }
                                    elseif(isset($wl_user->addresses->personal->region))
                                    {
                                        $user_locale = $wl_user->addresses->personal->region;
                                        
                                    }
                                }
                                
                                $tw_access_token = json_decode($user->data['session_tw_access_token']);
                
                                if($tw_access_token->oauth_token)
                                {   
                                    include($phpbb_root_path . 'alternatelogin/twitter/tmhOAuth.' . $phpEx);
 
                                    $al_login = 1;
                                    $al_login_type = AL_TWITTER_LOGIN;
 
                                    $tmhOAuth = new tmhOAuth(array(
                                        'consumer_key'      => $config['al_tw_key'],
                                        'consumer_secret'   => $config['al_tw_secret'],
                                    ));
 
                                    $tmhOAuth->config['user_token'] = $tw_access_token->oauth_token;
                                    $tmhOAuth->config['user_secret'] = $tw_access_token->oauth_token_secret;
 
                                    $code = $tmhOAuth->request('GET', $tmhOAuth->url('1/account/verify_credentials'));
 
                                    if($code == 200)
                                    {
                                        $tw_user = json_decode($tmhOAuth->response['response']);
                                    }
                                    else
                                    {
                                        trigger_error($tmhOAuth->response['response']);
                                    }
 
                                }]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['interests'		=> utf8_normalize_nfc(request_var('interests', $user->data['user_interests'], true)),
				);]]></find> 
				<action type="after-add"><![CDATA[                                if($fb_sync)
                                {
 
                                    $data['website'] = (!$fb_user->website) ? '' : $fb_user->website;
                                    $data['location'] = (!$fb_user->location->name) ? '' : $fb_user->location->name;
                                    $data['occupation'] = (!$fb_user->work[0]->employer->name) ? '' : $fb_user->work[0]->employer->name;
                                }
                                
                                if($wl_sync)
                                {
                                    $data['user_from']                      = (!$user_locale) ? '' : $user_locale;
                                    $data['user_occ']                       = (!$wl_user->work[0]->employer->name) ? '' : $wl_user->work[0]->employer->name;
                                }
                                
                                if($tw_sync)
                                {
                                    $data['user_from']                      = (!$tw_user->location) ? '' : $tw_user->location;
                                    $data['website']                        = (!$tw_user->url) ? '' : $tw_user->url;
                                    
                                }
                                ]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[add_form_key('ucp_profile_info');]]></find> 
				<action type="before-add"><![CDATA[                                if($fb_sync)
                                {
                                    $bday = explode('/', $fb_user->birthday);
                                    $data['bday_day'] = $bday[1];
                                    $data['bday_month'] = $bday[0];
                                    $data['bday_year'] = $bday[2];
                                    $data['user_birthday'] = sprintf('%2d-%2d-%4d', $data['bday_day'], $data['bday_month'], $data['bday_year']);
                                }
                                if($wl_sync)
                                {
                                    $data['user_birthday']                  = sprintf('%2d-%2d-%4d', $wl_user->birth_day, $wl_user->birth_month, $wl_user->birth_year);
                                    $data['bday_day'] = $wl_user->birth_day;
                                    $data['bday_month'] = $wl_user->birth_month;
                                    $data['bday_year'] = $wl_user->birth_year;
                                }
 
 
                                $data['al_fb_profile_sync'] = $fb_sync;
                                $data['al_wl_profile_sync'] = $wl_sync;
                                $data['al_tw_profile_sync'] = $tw_sync;]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['user_notify_type'	=> $data['notify'],]]></find> 
				<action type="before-add"><![CDATA[                                                        'al_fb_profile_sync'    => $data['al_fb_profile_sync'],
                                                        'al_wl_profile_sync'    => $data['al_wl_profile_sync'],
                                                        'al_tw_profile_sync'    => $data['al_tw_profile_sync'],]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['INTERESTS'	=> $data['interests'],]]></find> 
				<action type="after-add"><![CDATA[                                        'FB_WEBSITE'    => ($fb_user) ? $fb_user->website : '',
                                        'FB_LOCATION'   => ($fb_user) ? $fb_user->location->name : '',
                                        'FB_OCCUPATION' => ($fb_user) ? $fb_user->work[0]->employer->name : '',
                                    
                                        'WL_LOCATION'   => ($wl_user) ? $user_locale : '',
                                        'WL_OCCUPATION' => ($wl_user) ? $wl_user->work[0]->employer->name : '',
                                        
                                        'TW_WEBSITE'    => $tw_user->url,
                                        'TW_LOCATION'   => $tw_user->location,
 
                                        'FB_SYNC'       => ($user->data['al_fb_profile_sync']) ? 'checked="checked"' : '',
                                        'WL_SYNC'       => ($user->data['al_wl_profile_sync']) ? 'checked="checked"' : '',
                                        'TW_SYNC'       => ($user->data['al_tw_profile_sync']) ? 'checked="checked"' : '',
 
                                        'AL_FB_USER'    => $user->data['al_fb_id'] ? true : false,
                                        'AL_WL_USER'    => $user->data['al_wl_id'] ? true : false,
                                        'AL_TW_USER'    => $user->data['al_tw_id'] ? true : false,]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[include($phpbb_root_path . 'includes/functions_posting.' . $phpEx);
				include($phpbb_root_path . 'includes/functions_display.' . $phpEx);]]></find> 
				<action type="after-add"><![CDATA[                                include($phpbb_root_path . 'includes/functions_alternatelogin.' . $phpEx);
 
                                if($user->data['al_fb_id'])
                                {
                                    $graph_url = "https://graph.facebook.com/me/statuses?" . $user->data['session_fb_access_token'];
                                    //echo 'Graph: ' . $graph_url;
                                    $fb_user = json_decode(get_fb_data($graph_url));
 
                                }
                                
                                $fb_status = (request_var('fb_status', '') == 'on') ? 1 : 0;
                                
                                $tw_access_token = json_decode($user->data['session_tw_access_token']);
                                
                                if($tw_access_token->oauth_token && $user->data['al_tw_id'])
                                {   
                                    include($phpbb_root_path . 'alternatelogin/twitter/tmhOAuth.' . $phpEx);
 
                                    $al_login = 1;
                                    $al_login_type = AL_TWITTER_LOGIN;
 
                                    $tmhOAuth = new tmhOAuth(array(
                                        'consumer_key'      => $config['al_tw_key'],
                                        'consumer_secret'   => $config['al_tw_secret'],
                                    ));
 
                                    $tmhOAuth->config['user_token'] = $tw_access_token->oauth_token;
                                    $tmhOAuth->config['user_secret'] = $tw_access_token->oauth_token_secret;
 
                                    $code = $tmhOAuth->request('GET', $tmhOAuth->url('1/account/verify_credentials'));
 
                                    if($code == 200)
                                    {
                                        $tw_user = json_decode($tmhOAuth->response['response']);
                                    }
                                    else
                                    {
                                        trigger_error($tmhOAuth->response['response']);
                                    }
                                    
                                }
                                
                                $tw_status = (request_var('tw_status', '') == 'on') ? 1 : 0;]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['user_sig_bbcode_bitfield'	=> $message_parser->bbcode_bitfield]]></find> 
				<action type="replace-with"><![CDATA[                                                       'user_sig_bbcode_bitfield'	=> $message_parser->bbcode_bitfield,
                                                                'al_fb_status_sync'             => ($fb_status == NULL) ? 0 : $fb_status,
                                                                'al_tw_status_sync'             => ($tw_status == NULL) ? 0 : $tw_status,]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['S_LINKS_ALLOWED'		=> ($config['allow_sig_links']) ? true : false)]]></find> 
				<action type="replace-with"><![CDATA[                             'S_LINKS_ALLOWED'		=> ($config['allow_sig_links']) ? true : false,
                                        'AL_FB_USER'                    => $user->data['al_fb_id'] ? true : false,
                                        'S_FB_STATUS_CHECKED'           => $user->data['al_fb_status_sync'] ? 'checked="checked"' : '',
                                        'S_FB_STATUS'                   => $fb_user->data[0]->message,
                                        'AL_TW_USER'                    => $user->data['al_tw_id'] ? true : false,
                                        'S_TW_STATUS_CHECKED'           => $user->data['al_tw_status_sync'] ? 'checked="checked"' : '',
                                        'S_TW_STATUS'                   => $tw_user->status->text,
                                        )]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[$display_gallery = request_var('display_gallery', '0');]]></find> 
				<action type="before-add"><![CDATA[                     include($phpbb_root_path . 'includes/functions_alternatelogin.' . $phpEx);
                                $fb_avatar = (request_var('fb_avatar', '') == 'on') ? 1 : 0;
                                $wl_avatar = (request_var('wl_avatar', '') == 'on') ? 1 : 0;
                                $tw_avatar = (request_var('tw_avatar', '') == 'on') ? 1 : 0;
                                $wl_url = "https://apis.live.net/v5.0/{$user->data['al_wl_id']}/picture";
                                $fb_url = 'https://graph.facebook.com/' . $user->data['al_fb_id'] . '/picture?type=normal';]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[if (check_form_key('ucp_avatar'))
					{]]></find> 
				<action type="after-add"><![CDATA[                                                if($fb_avatar || $wl_avatar || $tw_avatar)
                                                {
 
                                                    if($fb_avatar)
                                                    {
                                                        $sql_array['user_avatar']   = $fb_url;
                                                        $sql_array['al_fb_avatar_sync']     = 1;
                                                    }
                                                    if($wl_avatar)
                                                    {
                                                        
                                                        $sql_array['user_avatar']   = $wl_url;
                                                        $sql_array['al_wl_avatar_sync']     = 1;
                                                    }
                                                    if($tw_avatar)
                                                    {
                                                        $tw_access_token = json_decode($user->data['session_tw_access_token']);
                                
                                                        if($tw_access_token->oauth_token && $user->data['al_tw_id'])
                                                        {   
                                                            include($phpbb_root_path . 'alternatelogin/twitter/tmhOAuth.' . $phpEx);
                                                            
                                                            $al_login = 1;
                                                            $al_login_type = AL_TWITTER_LOGIN;
 
                                                            $tmhOAuth = new tmhOAuth(array(
                                                                'consumer_key'      => $config['al_tw_key'],
                                                                'consumer_secret'   => $config['al_tw_secret'],
                                                            ));
 
                                                            $tmhOAuth->config['user_token'] = $tw_access_token->oauth_token;
                                                            $tmhOAuth->config['user_secret'] = $tw_access_token->oauth_token_secret;
 
                                                            $code = $tmhOAuth->request('GET', $tmhOAuth->url('1/account/verify_credentials'));
 
                                                            if($code == 200)
                                                            {
                                                                $tw_user = json_decode($tmhOAuth->response['response']);
                                                            }
                                                            else
                                                            {
                                                                trigger_error($tmhOAuth->response['response']);
                                                            }
                                                            
                                                            $sql_array['user_avatar']   = $tw_user->profile_image_url;
                                                            $sql_array['al_tw_avatar_sync']     = 1;
                                                        }
                                                    }
 
                                                    $sql_array = array_merge($sql_array, array(
                                                        
                                                        'user_avatar_type'      => AVATAR_REMOTE,
                                                        'user_avatar_width'     => 100,
                                                        'user_avatar_height'    => 100,
                                                    ));
 
 
 
                                                    $sql = "UPDATE " . USERS_TABLE . " SET " . $db->sql_build_array('UPDATE', $sql_array) .
                                                                " WHERE user_id=" . $user->data['user_id'];
 
                                                    $db->sql_query($sql);
 
                                                    meta_refresh(3, $this->u_action);
                                                    $message = $user->lang['PROFILE_UPDATED'] . '<br /><br />' . sprintf($user->lang['RETURN_UCP'], '<a href="' . $this->u_action . '">', '</a>');
                                                    trigger_error($message);
                                                }]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['L_AVATAR_EXPLAIN'	=> sprintf($user->lang['AVATAR_EXPLAIN'], $config['avatar_max_width'], $config['avatar_max_height'], $config['avatar_filesize'] / 1024),]]></find> 
				<action type="after-add"><![CDATA[                                        'FB_AVATAR'             => $user->data['al_fb_avatar_sync'] ? 'checked="checked"' : '',
                                        'AL_FB_USER'            => $user->data['al_fb_id'],
                                        'TW_AVATAR'             => $user->data['al_tw_avatar_sync'] ? 'checked="checked"' : '',
                                        'AL_TW_USER'            => $user->data['al_tw_id'],]]></action> 
			</edit> 
		</open> 
		<open src="includes/ucp/ucp_register.php"> 
			<edit> 
				<find><![CDATA[include($phpbb_root_path . 'includes/functions_profile_fields.' . $phpEx);]]></find> 
				<action type="after-add"><![CDATA[		include($phpbb_root_path . 'includes/functions_alternatelogin.' . $phpEx);]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[$user_lang		= request_var('lang', $user->lang_name);]]></find> 
				<action type="after-add"><![CDATA[		$sql_array = array(
                    'SELECT'    => 'session_wl_access_token, session_tw_access_token',
                    'FROM'      =>array(SESSIONS_TABLE => 's'),
                    'WHERE'     => "session_id='" . $user->data['session_id'] . "'",
                );
                
                $sql = $db->sql_build_query('SELECT', $sql_array);
                
                $result = $db->sql_query($sql);
                
                $wl_access_token = $db->sql_fetchfield('session_wl_access_token');
                
                $db->sql_freeresult($result);
                
                if($wl_access_token)
                {   
                    $al_login = 1;
                    $al_login_type = AL_WINDOWSLIVE_LOGIN;
                }
                
                $tw_access_token = json_decode($user->data['session_tw_access_token']);
                
                if($tw_access_token->oauth_token)
                {   
                    include($phpbb_root_path . 'alternatelogin/twitter/tmhOAuth.' . $phpEx);
                    
                    $al_login = 1;
                    $al_login_type = AL_TWITTER_LOGIN;
                    
                    $tmhOAuth = new tmhOAuth(array(
                        'consumer_key'      => $config['al_tw_key'],
                        'consumer_secret'   => $config['al_tw_secret'],
                    ));
 
                    $tmhOAuth->config['user_token'] = $tw_access_token->oauth_token;
                    $tmhOAuth->config['user_secret'] = $tw_access_token->oauth_token_secret;
                    
                    $code = $tmhOAuth->request('GET', $tmhOAuth->url('1/account/verify_credentials'));
                    
                    if($code == 200)
                    {
                        $tw_user = json_decode($tmhOAuth->response['response']);
                    }
                    else
                    {
                        trigger_error($tmhOAuth->response['response']);
                    }
                    
                }
                
                $openid_identifier = request_var('openid_identifier', '');
                $openid_email = request_var('openid_email', '');
                
                if($openid_identifier != '')
                {
                    $al_login = 1;
                    $al_login_type = AL_OPENID_LOGIN;
                    
                }]]></action> 
			</edit> 
                        <edit>
                        <find><![CDATA[// Checking amount of available languages
			$sql = 'SELECT lang_id
				FROM ' . LANG_TABLE;]]></find>
                                <action type="before-add"><![CDATA[if($openid_identifier != '')
                        {
                            $s_hidden_fields = array_merge($s_hidden_fields, array(
                                'al_login'              => $al_login,
                                'al_login_type'         => $al_login_type,
                                'openid_identifier'     => $openid_identifier,
                                'openid_email'          => $openid_email,
                            ));
                            
                            
                        }]]></action>
                        </edit>
			<edit> 
				<find><![CDATA[if ($submit)
		{
]]></find> 
				<action type="before-add"><![CDATA[                if($al_login)
                {
 
                    switch($al_login_type)
                    {
                        case AL_WINDOWSLIVE_LOGIN:
                            $wl_user = get_wl_rest_request($wl_access_token, 'me', HTTP_GET);
                            
                            $data['username']           = ($data['username'] == '') ? utf8_normalize_nfc($wl_user->name) : $data['username'];
                            $data['email']              = strtolower($wl_user->emails->preferred);
                            $data['email_confirm']              = strtolower($wl_user->emails->preferred);
                            
                            
                        break;
                        
                        case AL_TWITTER_LOGIN:
                            $wl_user = get_wl_rest_request($wl_access_token, 'me', HTTP_GET);
                            
                            $data['username']           = ($data['username'] == '') ? utf8_normalize_nfc($tw_user->screen_name) : $data['username'];
                            //$data['email']              = strtolower($wl_user->emails->preferred);
                            $data['email_confirm']              = $data['email'];
                            
                        break;
                        
                        case AL_OPENID_LOGIN:
                            
                            if($openid_email != '')
                            {
                                $data['email']              = $openid_email;
                                $data['email_confirm']      = $openid_email;
                            }
                        break;
                    }
                }]]></action> 
			</edit> 
                        <edit>
                            <find><![CDATA[if ($config['new_member_post_limit'])
				{
					$user_row['user_new'] = 1;
				}]]></find>
                            <action type="before-add"><![CDATA[                                if($al_login)
				{
					
                                    switch($al_login_type)
                                    {
                                        case AL_WINDOWSLIVE_LOGIN:
 
                                            $user_row['al_wl_id'] = $wl_user->id;
 
                                            $al_email_lang = $user->lang['WINDOWSLIVE'];
 
                                            
                                            
 
                                            break;
 
                                        case AL_TWITTER_LOGIN:
                                            $user_row['al_tw_id'] = $tw_user->id;
 
                                            $al_email_lang = $user->lang['TWITTER'];
                                            
                                            
                                            
                                            break;
                                            
                                        case AL_OPENID_LOGIN:
                                            
                                            $user_row['al_oi_id'] = $openid_identifier;
                                            
                                            $al_email_lang = $user->lang['OPENID'];
                                            
                                            
                                            break;
                                    }
				}]]></action>
                        </edit>
			
			<edit> 
				<find><![CDATA[    $email_template = 'coppa_welcome_inactive';]]></find> 
				<action type="replace-with"><![CDATA[        if($al_login)
					{
						$email_template = 'coppa_welcome_inactive_alternatelogin';
					}
					else
					{
						$email_template = 'coppa_welcome_inactive';
					}
]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[    $email_template = 'user_welcome_inactive';]]></find> 
				<action type="replace-with"><![CDATA[        if($al_login)
					{
						$email_template = 'user_welcome_inactive_alternatelogin';
					}
					else
					{
						$email_template = 'user_welcome_inactive';
					}
]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[    $email_template = 'admin_welcome_inactive';]]></find> 
				<action type="replace-with"><![CDATA[        if($al_login)
					{
						$email_template = 'admin_welcome_inactive_alternatelogin';
					}
					else
					{
						$email_template = 'admin_welcome_inactive';
					}
]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[    $email_template = 'user_welcome';]]></find> 
				<action type="replace-with"><![CDATA[        if($al_login)
					{
						$email_template = 'user_welcome_alternatelogin';
					}
					else
					{
						$email_template = 'user_welcome';
					}
]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['WELCOME_MSG'	=> htmlspecialchars_decode(sprintf($user->lang['WELCOME_SUBJECT'], $config['sitename'])),
						'USERNAME'		=> htmlspecialchars_decode($data['username']),
						'PASSWORD'		=> htmlspecialchars_decode($data['new_password']),
]]></find> 
				<action type="after-add"><![CDATA[						'AL_LOGIN_TYPE'		=> $al_email_lang,]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['change_lang'	=> 0,]]></find> 
				<action type="after-add"><![CDATA[                        'al_login'        => $al_login,
			'al_login_type'     => $al_login_type,
                        'openid_identifier' => $openid_identifier,
                        'openid_email'      => $openid_email,]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA['L_PASSWORD_EXPLAIN'		=> sprintf($user->lang[$config['pass_complex'] . '_EXPLAIN'], $config['min_pass_chars'], $config['max_pass_chars']),]]></find> 
				<action type="after-add"><![CDATA[                        'S_AL_LOGIN'		=> $al_login,
                        'S_AL_TWITTER'          => ($al_login_type == AL_TWITTER_LOGIN) ? true : false,
                        'S_AL_OPENID'           => ($al_login_type == AL_OPENID_LOGIN) ? true : false,]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/index_body.html"> 
			<edit> 
				<find><![CDATA[<!-- IF S_DISPLAY_SEARCH or (S_USER_LOGGED_IN and not S_IS_BOT) -->]]></find> 
				<action type="before-add"><![CDATA[<fb:like href="{BOARD_URL}" show_faces="false" width="450" font="arial"></fb:like>]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[<!-- INCLUDE forumlist_body.html -->]]></find> 
				<action type="replace-with"><![CDATA[<!-- IF AL_FB_FACEPILE | AL_FB_ACTIVITY | AL_FB_STREAM | AL_FB_LIKE_BOX --> 
<table width="100%"> 
    <tr> 
        <td valign="top"> 
<!-- ENDIF --> 
            <!-- INCLUDE forumlist_body.html --> 
<!-- IF AL_FB_FACEPILE | AL_FB_ACTIVITY | AL_FB_STREAM | AL_FB_LIKE_BOX --> 
        </td> 
        
        <!-- IF (AL_FB_ACTIVITY and not AL_FB_USER_HIDE_ACTIVITY) or (AL_FB_STREAM and not AL_FB_USER_HIDE_STREAM) or (AL_FB_LIKE_BOX and not AL_FB_USER_HIDE_LIKE_BOX) --> 
        <td width="200" valign="top"> 
        <!-- ENDIF --> 
        
        <!-- IF AL_FB_LIKE_BOX and not AL_FB_USER_HIDE_LIKE_BOX --> 
        
                <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                            <fb:like-box href="{AL_FB_PAGE_URL}" width="300" show_faces="true" stream="true" header="true"></fb:like-box>
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_ACTIVITY and not AL_FB_USER_HIDE_ACTIVITY --> 
        
                <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                            <fb:activity site="{AL_FB_SITE_DOMAIN}" width="300" height="300" header="true" font="arial" border_color="" recommendations="true"></fb:activity> 
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_STREAM and not AL_FB_USER_HIDE_STREAM --> 
        <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                        <fb:live-stream event_app_id="{AL_FB_APPID}" width="300" height="500" xid="" always_post_to_friends="false"></fb:live-stream> 
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
        <!-- ENDIF --> 
        <!-- IF (AL_FB_ACTIVITY and not AL_FB_USER_HIDE_ACTIVITY) or (AL_FB_STREAM and not AL_FB_USER_HIDE_STREAM) --> 
        </td> 
        <!-- ENDIF --> 
    </tr> 
    <!-- IF AL_FB_FACEPILE and not AL_FB_USER_HIDE_FACEPILE --> 
    <tr> 
        <td<!-- IF AL_FB_ACTIVITY --> colspan="2"<!-- ENDIF -->>
                <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                        
                        <fb:facepile href="{BOARD_URL}" width="200" max_rows="1"></fb:facepile> 
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
 
 
        </td> 
    </tr> 
    <!-- ENDIF --> 
</table> 
<!-- ENDIF -->]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[<!-- ENDIF -->

<!-- IF S_DISPLAY_ONLINE_LIST -->]]></find> 
				<action type="before-add"><![CDATA[<!-- IF (S_AL_WL_ENABLED or S_AL_FB_ENABLED or S_AL_TW_ENABLED or S_AL_OI_ENABLED) and not S_ADMIN_AUTH -->
 <div class="panel bg3">
   <div class="inner"><span class="corners-top"><span></span></span>
      
 <h3>{L_SOCIAL_LOGIN_OPTIONS}</h3> 
                <br /> 
            <!-- IF S_AL_WL_ENABLED --> 
            <a href="{U_AL_WL_AUTHORIZE}"><img src="alternatelogin/images/windows_live_connect.png" alt="Windows Live" /></a> 
        <!-- ENDIF --> 
 
        <!-- IF S_AL_FB_ENABLED --> 
            <a onclick="window.location='alternatelogin/al_fb_connect.php';" href="#"> 
                    <img src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Login with your Facebook account!" /> 
            </a> 
        <!-- ENDIF --> 
      <!-- IF S_AL_TW_ENABLED --> 
        <a href="{U_AL_TW_REQUEST}"><img src="alternatelogin/images/sign-in-with-twitter-l.png" alt="Twitter" /></a> 
        <!-- ENDIF --> 
        
        <!-- IF S_AL_OI_ENABLED --> 
        <link type="text/css" rel="stylesheet" href="{T_TEMPLATE_PATH}/css/openid.css" />
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/jquery-1.2.6.min.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-jquery.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-en.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			openid.init('openid_identifier');
			
		});
	</script>
        <form action="{U_AL_OI_LOGIN}" method="get" id="openid_form">
		<input type="hidden" name="action" value="verify" />
		<fieldset>
			
			<div id="openid_choice">
				
				<div id="openid_btns"></div>
			</div>
			<div id="openid_input_area">
				<input id="openid_identifier" name="openid_identifier" type="text" value="http://" />
				<input id="openid_submit" type="submit" value="Sign-In"/>
			</div>
			
		</fieldset>
	</form>
        <!-- ENDIF --> 
      

   <span class="corners-bottom"><span></span></span></div>
</div>
 <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/login_body.html"> 
			<edit> 
				<find><![CDATA[</fieldset> 
    
	</div>]]></find> 
				<action type="after-add"><![CDATA[        <!-- IF (S_AL_WL_ENABLED or S_AL_FB_ENABLED or S_AL_TW_ENABLED) and not S_ADMIN_AUTH -->
 <div class="panel bg3">
   <div class="inner"><span class="corners-top"><span></span></span>
      
 <h3>{L_SOCIAL_LOGIN_OPTIONS}</h3> 
                <br /> 
            <!-- IF S_AL_WL_ENABLED --> 
            <a href="{U_AL_WL_AUTHORIZE}"><img src="alternatelogin/images/windows_live_connect.png" alt="Windows Live Connect" /></a> 
        <!-- ENDIF --> 
 
        <!-- IF S_AL_FB_ENABLED --> 
            <a onclick="window.location='alternatelogin/al_fb_connect.php{S_RETURN_TO_PAGE}';" href="#"> 
                    <img src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Login with your Facebook account!" /> 
            </a> 
        <!-- ENDIF --> 
      <!-- IF S_AL_TW_ENABLED --> 
        <a href="{U_AL_TW_REQUEST}"><img src="alternatelogin/images/sign-in-with-twitter-l.png" alt="Windows Live Connect" /></a> 
        <!-- ENDIF --> 
      
      <!-- IF S_AL_OI_ENABLED --> 
        <link type="text/css" rel="stylesheet" href="{T_TEMPLATE_PATH}/css/openid.css" />
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/jquery-1.2.6.min.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-jquery.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-en.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			openid.init('openid_identifier');
			
		});
	</script>
        <form action="{U_AL_OI_LOGIN}" method="get" id="openid_form">
		<input type="hidden" name="action" value="verify" />
		<fieldset>
			<legend>Sign-in or Create New Account</legend>
			<div id="openid_choice">
				<p>Please click your account provider:</p>
				<div id="openid_btns"></div>
			</div>
			<div id="openid_input_area">
				<input id="openid_identifier" name="openid_identifier" type="text" value="http://" />
				<input id="openid_submit" type="submit" value="Sign-In"/>
			</div>
			
		</fieldset>
	</form>
        <!-- ENDIF --> 
   <span class="corners-bottom"><span></span></span></div>
</div>
 <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/overall_header.html"> 
			<edit> 
				<find><![CDATA[<body id="phpbb" class="section-{SCRIPT_NAME} {S_CONTENT_DIRECTION}">]]></find> 
				<action type="after-add"><![CDATA[<!-- IF S_AL_FB_ENABLED --><div id="fb-root"></div><script src="http://connect.facebook.net/{S_FB_LOCALE}/all.js#appId={AL_FB_APPID}&xfbml=1"></script>  
<script> 
  window.fbAsyncInit = function() {
    FB.init({appId: '{AL_FB_APPID}', status: true, cookie: true,
             xfbml: true});
  };
  (function() {
    var e = document.createElement('script'); e.async = true;
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    document.getElementById('fb-root').appendChild(e);
  }());
</script><!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/ucp_avatar_options.html"> 
			<edit> 
				<find><![CDATA[<!-- IF ERROR --><p class="error">{ERROR}</p><!-- ENDIF -->]]></find> 
				<action type="after-add"><![CDATA[        <!-- IF AL_FB_USER --> 
<dl> 
            <dt><label for="fb_avatar">{L_FB_AVATAR}</label><br /><span>{L_FB_AVATAR_EXPLAIN}</span></dt> 
            <dd><input type="checkbox" name="fb_avatar" id="fb_avatar" {FB_AVATAR} /></dd> 
        </dl> 
        <!-- ENDIF --> 
        <!-- IF AL_WL_USER --> 
        <dl> 
            <dt><label for="wl_avatar">{L_WL_AVATAR}</label><br /><span>{L_WL_AVATAR_EXPLAIN}</span></dt> 
            <dd><input type="checkbox" name="wl_avatar" id="wl_avatar" {WL_AVATAR} /></dd> 
        </dl> 
        <!-- ENDIF --> 
        <!-- IF AL_TW_USER --> 
        <dl> 
            <dt><label for="tw_avatar">{L_TW_AVATAR}</label><br /><span>{L_TW_AVATAR_EXPLAIN}</span></dt> 
            <dd><input type="checkbox" name="tw_avatar" id="tw_avatar" {TW_AVATAR} /></dd> 
        </dl> 
        <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/ucp_prefs_personal.html"> 
			<edit> 
				<find><![CDATA[<!-- IF S_SELECT_NOTIFY -->]]></find> 
				<action type="before-add"><![CDATA[        <!-- IF AL_FB_ACTIVITY --> 
                        <dl> 
			<dt><label for="al_fb_activity0">{L_AL_FB_HIDE_ACTIVITY}:</label></dt> 
			<dd> 
				<label for="al_fb_activity0"><input type="radio" name="al_fb_activity" id="al_fb_activity0" value="1"<!-- IF S_AL_FB_HIDE_ACTIVITY --> checked="checked"<!-- ENDIF --> /> {L_YES}</label> 
				<label for="al_fb_activity1"><input type="radio" name="al_fb_activity" id="al_fb_activity1" value="0"<!-- IF not S_AL_FB_HIDE_ACTIVITY --> checked="checked"<!-- ENDIF --> /> {L_NO}</label> 
			</dd> 
		</dl> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_STREAM --> 
                <dl> 
			<dt><label for="al_fb_stream0">{L_AL_FB_HIDE_STREAM}:</label></dt> 
			<dd> 
				<label for="al_fb_stream0"><input type="radio" name="al_fb_stream" id="al_fb_stream0" value="1"<!-- IF S_AL_FB_HIDE_STREAM --> checked="checked"<!-- ENDIF --> /> {L_YES}</label> 
				<label for="al_fb_stream1"><input type="radio" name="al_fb_stream" id="al_fb_stream1" value="0"<!-- IF not S_AL_FB_HIDE_STREAM --> checked="checked"<!-- ENDIF --> /> {L_NO}</label> 
			</dd> 
		</dl> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_FACEPILE --> 
                <dl> 
			<dt><label for="al_fb_facepile0">{L_AL_FB_HIDE_FACEPILE}:</label></dt> 
			<dd> 
				<label for="al_fb_facepile0"><input type="radio" name="al_fb_facepile" id="al_fb_facepile0" value="1"<!-- IF S_AL_FB_HIDE_FACEPILE --> checked="checked"<!-- ENDIF --> /> {L_YES}</label> 
				<label for="al_fb_facepile1"><input type="radio" name="al_fb_facepile" id="al_fb_facepile1" value="0"<!-- IF not S_AL_FB_HIDE_FACEPILE --> checked="checked"<!-- ENDIF --> /> {L_NO}</label> 
			</dd> 
		</dl> 
                <!-- IF AL_FB_LIKE_BOX --> 
                <dl> 
			<dt><label for="al_fb_like_box0">{L_AL_FB_HIDE_LIKE_BOX}:</label></dt> 
			<dd> 
				<label for="al_fb_like_box0"><input type="radio" name="al_fb_like_box" id="al_fb_like_box0" value="1"<!-- IF S_AL_FB_HIDE_LIKE_BOX --> checked="checked"<!-- ENDIF --> /> {L_YES}</label> 
				<label for="al_fb_like_box1"><input type="radio" name="al_fb_like_box" id="al_fb_like_box1" value="0"<!-- IF not S_AL_FB_HIDE_LIKE_BOX --> checked="checked"<!-- ENDIF --> /> {L_NO}</label> 
			</dd> 
		</dl> 
        <!-- ENDIF -->
        <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/ucp_profile_profile_info.html"> 
			<edit> 
				<find><![CDATA[<!-- INCLUDE ucp_header.html -->]]></find> 
				<action type="after-add"><![CDATA[<script> 
    function apply_fb_data()
    {
        var v_website       = '{FB_WEBSITE}';
        var v_location      = '{FB_LOCATION}';
        var v_occupation    = '{FB_OCCUPATION}';
 
        if(document.getElementById('fb_sync').checked)
        {
            document.getElementById('website').value = v_website;
            document.getElementById('location').value = v_location;
            document.getElementById('occupation').value = v_occupation;
        }
    }
    function apply_wl_data()
    {
        
        var v_location      = '{WL_LOCATION}';
        var v_occupation    = '{WL_OCCUPATION}';
        
        if(document.getElementById('wl_sync').checked)
        {
            
            document.getElementById('location').value = v_location;
            document.getElementById('occupation').value = v_occupation;
        }
    }
    function apply_tw_data()
    {
        
        var v_location      = '{TW_LOCATION}';
        var v_website    = '{TW_WEBSITE}';
        
        if(document.getElementById('tw_sync').checked)
        {
            
            document.getElementById('location').value = v_location;
            document.getElementById('website').value = v_website;
        }
    }
</script>]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[<!-- IF ERROR --><p class="error">{ERROR}</p><!-- ENDIF -->]]></find> 
				<action type="after-add"><![CDATA[<!-- IF AL_FB_USER --> 
        <dl> 
		<dt><label for="fb_sync">{L_FB_SYNC}:</label></dt> 
                <dd><input type="checkbox" name="fb_sync" id="fb_sync" {FB_SYNC} class="checkbox" onclick="apply_fb_data();"/></dd> 
	</dl> 
        <!-- ENDIF --> 
        <!-- IF AL_WL_USER --> 
        <dl> 
		<dt><label for="wl_sync">{L_WL_SYNC}:</label></dt> 
                <dd><input type="checkbox" name="wl_sync" id="wl_sync" {WL_SYNC} class="checkbox" onclick="apply_wl_data();"/></dd> 
	</dl> 
        <!-- ENDIF --> 
        <!-- IF AL_TW_USER --> 
        <dl> 
		<dt><label for="tw_sync">{L_TW_SYNC}:</label></dt> 
                <dd><input type="checkbox" name="tw_sync" id="tw_sync" {TW_SYNC} class="checkbox" onclick="apply_tw_data();"/></dd> 
	</dl> 
        <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/ucp_profile_signature.html"> 
			<edit> 
				<find><![CDATA[<!-- INCLUDE ucp_header.html -->]]></find> 
				<action type="after-add"><![CDATA[<script> 
    var fb_status = "{S_FB_STATUS}";
 
    function apply_fb_status()
    {
        document.getElementsByName('signature')[0].innerHTML = fb_status;
    }
 
    var wl_status = "{S_WL_STATUS}";
 
    function apply_wl_status()
    {
        document.getElementsByName('signature')[0].innerHTML = wl_status;
    }
    
    var tw_status = "{S_TW_STATUS}";
 
    function apply_tw_status()
    {
        document.getElementsByName('signature')[0].innerHTML = tw_status;
    }
</script>]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[<h3>{L_OPTIONS}</h3> 
	<fieldset>]]></find> 
				<action type="after-add"><![CDATA[<!-- IF AL_FB_USER --> 
                        <div><label for="fb_status"><input type="checkbox" name="fb_status" id="fb_status"{S_FB_STATUS_CHECKED} onclick="apply_fb_status();"/> {L_FB_STATUS}</label></div> 
                <!-- ENDIF --> 
                <!-- IF AL_WL_USER --> 
                        <div><label for="wl_status"><input type="checkbox" name="wl_status" id="wl_status"{S_WL_STATUS_CHECKED} onclick="apply_wl_status();"/> {L_WL_STATUS}</label></div> 
                <!-- ENDIF -->
                <!-- IF AL_TW_USER --> 
                        <div><label for="tw_status"><input type="checkbox" name="tw_status" id="tw_status"{S_TW_STATUS_CHECKED} onclick="apply_tw_status();"/> {L_TW_STATUS}</label></div> 
                <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/prosilver/template/ucp_register.html"> 
			<edit> 
				<find><![CDATA[<form method="post" action="{S_UCP_ACTION}" id="register">]]></find> 
				<action type="before-add"><![CDATA[<!-- IF (S_AL_WL_ENABLED or S_AL_FB_ENABLED or S_AL_TW_ENABLED or S_AL_OI_ENABLED) and not S_ADMIN_AUTH -->
 <div class="panel bg3">
   <div class="inner"><span class="corners-top"><span></span></span>
      
 <h3>{L_SOCIAL_LOGIN_OPTIONS}</h3> 
                <br /> 
            <!-- IF S_AL_WL_ENABLED --> 
            <a href="{U_AL_WL_AUTHORIZE}"><img src="alternatelogin/images/windows_live_connect.png" alt="Windows Live" /></a> 
        <!-- ENDIF --> 
 
        <!-- IF S_AL_FB_ENABLED --> 
            <a onclick="window.location='alternatelogin/al_fb_connect.php';" href="#"> 
                    <img src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Login with your Facebook account!" /> 
            </a> 
        <!-- ENDIF --> 
      <!-- IF S_AL_TW_ENABLED --> 
        <a href="{U_AL_TW_REQUEST}"><img src="alternatelogin/images/sign-in-with-twitter-l.png" alt="Twitter" /></a> 
        <!-- ENDIF --> 
        
        <!-- IF S_AL_OI_ENABLED --> 
        <link type="text/css" rel="stylesheet" href="{T_TEMPLATE_PATH}/css/openid.css" />
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/jquery-1.2.6.min.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-jquery.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-en.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			openid.init('openid_identifier');
			
		});
	</script>
        <form action="{U_AL_OI_LOGIN}" method="get" id="openid_form">
		<input type="hidden" name="action" value="verify" />
		<fieldset>
			
			<div id="openid_choice">
				
				<div id="openid_btns"></div>
			</div>
			<div id="openid_input_area">
				<input id="openid_identifier" name="openid_identifier" type="text" value="http://" />
				<input id="openid_submit" type="submit" value="Sign-In"/>
			</div>
			
		</fieldset>
	</form>
        <!-- ENDIF --> 
      

   <span class="corners-bottom"><span></span></span></div>
</div>
 <!-- ENDIF -->]]></action> 
			</edit> 
			 
		</open> 
		<open src="styles/prosilver/template/viewtopic_body.html"> 
			<edit> 
				<find><![CDATA[<a href="{U_VIEW_TOPIC}">{TOPIC_TITLE}</a>]]></find> 
				<action type="after-add"><![CDATA[&nbsp;&nbsp;<fb:like href="{U_PAGE_URL}" show_faces="false" width="450" font="arial"></fb:like>]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/index_body.html"> 
			<edit> 
				<find><![CDATA[<!-- INCLUDE forumlist_body.html -->]]></find> 
				<action type="replace-with"><![CDATA[<fb:like href="{BOARD_URL}" show_faces="false" width="450" font="arial"></fb:like>
				<!-- IF AL_FB_FACEPILE | AL_FB_ACTIVITY | AL_FB_STREAM | AL_FB_LIKE_BOX -->  
<table width="100%"> 
    <tr> 
        <td valign="top"> 
<!-- ENDIF --> 
            <!-- INCLUDE forumlist_body.html --> 
<!-- IF AL_FB_FACEPILE | AL_FB_ACTIVITY | AL_FB_STREAM | AL_FB_LIKE_BOX --> 
        </td> 
        
        <!-- IF (AL_FB_ACTIVITY and not AL_FB_USER_HIDE_ACTIVITY) or (AL_FB_STREAM and not AL_FB_USER_HIDE_STREAM) or (AL_FB_LIKE_BOX and not AL_FB_USER_HIDE_LIKE_BOX) --> 
        <td width="200" valign="top"> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_LIKE_BOX and not AL_FB_USER_HIDE_LIKE_BOX --> 
        
                <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                            <fb:like-box href="{AL_FB_PAGE_URL}" width="300" show_faces="true" stream="true" header="true"></fb:like-box>
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_ACTIVITY and not AL_FB_USER_HIDE_ACTIVITY --> 
        
                <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                            <fb:activity site="{AL_FB_SITE_DOMAIN}" width="300" height="300" header="true" font="arial" border_color="" recommendations="true"></fb:activity> 
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
        <!-- ENDIF --> 
        <!-- IF AL_FB_STREAM and not AL_FB_USER_HIDE_STREAM --> 
        <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                        <fb:live-stream event_app_id="{AL_FB_APPID}" width="300" height="500" xid="" always_post_to_friends="false"></fb:live-stream> 
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
        <!-- ENDIF --> 
        <!-- IF (AL_FB_ACTIVITY and not AL_FB_USER_HIDE_ACTIVITY) or (AL_FB_STREAM and not AL_FB_USER_HIDE_STREAM) --> 
        </td> 
        <!-- ENDIF --> 
    </tr> 
    <!-- IF AL_FB_FACEPILE and not AL_FB_USER_HIDE_FACEPILE --> 
    <tr> 
        <td<!-- IF AL_FB_ACTIVITY --> colspan="2"<!-- ENDIF -->>
                <div class="forabg"> 
		<div class="inner"><span class="corners-top"><span></span></span> 
 
                    <div class="panel"> 
                        
                        <fb:facepile href="{BOARD_URL}" width="200" max_rows="1"></fb:facepile> 
                    </div> 
                        <span class="corners-bottom"><span></span></span></div> 
	</div> 
 
 
        </td> 
    </tr> 
    <!-- ENDIF --> 
</table> 
<!-- ENDIF -->]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[{S_LOGIN_REDIRECT}]]></find> 
				<action type="before-add"><![CDATA[    
                <!-- IF S_AL_WL_ENABLED or S_AL_FB_ENABLED or S_AL_TW_ENABLED or S_AL_OI_ENABLED --> 
                <br /> 
                
                <center> 
                    <div style="padding: 0px 10px 10px 10px; border-style: solid; border-color: grey; border-width: 1px; width: 500px;"> 
                        <center> 
                            <h3>{L_SOCIAL_LOGIN_OPTIONS}</h3> 
                            <br /> 
                            <!-- IF S_AL_WL_ENABLED --> 
                            <a href="{U_AL_WL_AUTHORIZE}"><img src="alternatelogin/images/windows_live_connect.png" alt="Windows Live Connect" /></a> 
                            <!-- ENDIF --> 
 
                            <!-- IF S_AL_FB_ENABLED --> 
                            <a onclick="window.location='alternatelogin/al_fb_connect.php';" href="#"> 
                                    <img src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Login with your Facebook account!" /> 
                            </a> 
                            <!-- ENDIF --> 
 
                            <!-- IF S_AL_TW_ENABLED --> 
                            <a href="{U_AL_TW_REQUEST}"><img src="alternatelogin/images/sign-in-with-twitter-l.png" alt="Windows Live Connect" /></a> 
                            <!-- ENDIF --> 
                            
                            <!-- IF S_AL_OI_ENABLED --> 
<link type="text/css" rel="stylesheet" href="{T_TEMPLATE_PATH}/css/openid.css" />
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/jquery-1.2.6.min.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-jquery.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-en.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			openid.init('openid_identifier');
			
		});
	</script>
        <form action="alternatelogin/al_oi_connect.php" method="get" id="openid_form">
		<input type="hidden" name="action" value="verify" />
		<fieldset>
			<div id="openid_choice">
				<div id="openid_btns"></div>
			</div>
			<div id="openid_input_area">
				<input id="openid_identifier" name="openid_identifier" type="text" value="http://" />
				<input id="openid_submit" type="submit" value="Sign-In"/>
			</div>
			
		</fieldset>
	</form>
        <!-- ENDIF --> 
                        </center> 
                    </div> 
                </center> 
                
                <br /> 
                <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/login_body.html"> 
			<edit> 
				<find><![CDATA[    <td class="cat" <!-- IF not S_ADMIN_AUTH or S_CONFIRM_CODE -->colspan="2"<!-- ENDIF --> align="center">{S_HIDDEN_FIELDS}<input type="submit" name="login" class="btnmain" value="{L_LOGIN}" tabindex="5" /></td> 
</tr>]]></find> 
				<action type="after-add"><![CDATA[        <!-- IF (S_AL_WL_ENABLED or S_AL_FB_ENABLED or S_AL_TW_ENABLED) and not S_ADMIN_AUTH --> 
		
        <div style="padding: 0px 10px 10px 10px; border-style: solid; border-color: grey; border-width: 1px; width: 500px;"> 
            <center> 
                <h3>{L_SOCIAL_LOGIN_OPTIONS}</h3> 
                <br /> 
            <!-- IF S_AL_WL_ENABLED --> 
        <a href="{U_AL_WL_AUTHORIZE}"><img src="alternatelogin/images/windows_live_connect.png" alt="Windows Live Connect" /></a> 
        <!-- ENDIF --> 
 
        <!-- IF S_AL_FB_ENABLED --> 
            <a onclick="window.location='alternatelogin/al_fb_connect.php{S_RETURN_TO_PAGE}';" href="#"> 
                    <img src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Login with your Facebook account!" /> 
            </a> 
 
 
        <!-- ENDIF --> 
        
        <!-- IF S_AL_TW_ENABLED --> 
        <a href="{U_AL_TW_REQUEST}"><img src="alternatelogin/images/sign-in-with-twitter-l.png" alt="Windows Live Connect" /></a> 
        <!-- ENDIF --> 
        
        <!-- IF S_AL_OI_ENABLED --> 
        <link type="text/css" rel="stylesheet" href="{T_TEMPLATE_PATH}/css/openid.css" />
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/jquery-1.2.6.min.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-jquery.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-en.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			openid.init('openid_identifier');
			
		});
	</script>
        <form action="alternatelogin/al_oi_connect.php" method="get" id="openid_form">
		<input type="hidden" name="action" value="verify" />
		<fieldset>
			<legend>Sign-in or Create New Account</legend>
			<div id="openid_choice">
				<p>Please click your account provider:</p>
				<div id="openid_btns"></div>
			</div>
			<div id="openid_input_area">
				<input id="openid_identifier" name="openid_identifier" type="text" value="http://" />
				<input id="openid_submit" type="submit" value="Sign-In"/>
			</div>
			
		</fieldset>
	</form>
        <!-- ENDIF --> 
            </center> 
        </div> 
	<!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/overall_header.html"> 
			<edit> 
				<find><![CDATA[<body class="{S_CONTENT_DIRECTION}">]]></find> 
				<action type="after-add"><![CDATA[<!-- IF S_AL_FB_ENABLED --><div id="fb-root"></div><script src="http://connect.facebook.net/{S_FB_LOCALE}/all.js#appId={AL_FB_APPID}&xfbml=1"></script>  
<script> 
  window.fbAsyncInit = function() {
    FB.init({appId: '{AL_FB_APPID}', status: true, cookie: true,
             xfbml: true});
  };
  (function() {
    var e = document.createElement('script'); e.async = true;
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    document.getElementById('fb-root').appendChild(e);
  }());
</script><!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/ucp_prefs_personal.html"> 
			<edit> 
				<find><![CDATA[<!-- IF S_SELECT_NOTIFY -->]]></find> 
				<action type="before-add"><![CDATA[<!-- IF AL_FB_ACTIVITY --> 
        <tr> 
            <td class="row1" width="50%"><b class="genmed">{L_AL_FB_HIDE_ACTIVITY}:</b></td> 
            <td class="row2"><input type="radio" class="radio" name="al_fb_activity" value="1"<!-- IF S_AL_FB_HIDE_ACTIVITY --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_YES}</span>&nbsp;&nbsp;<input type="radio" class="radio" name="al_fb_activity" value="0"<!-- IF not S_AL_FB_HIDE_ACTIVITY --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_NO}</span></td> 
        </tr> 
<!-- ENDIF --> 
<!-- IF AL_FB_STREAM --> 
        <tr> 
            <td class="row1" width="50%"><b class="genmed">{L_AL_FB_HIDE_STREAM}:</b></td> 
            <td class="row2"><input type="radio" class="radio" name="al_fb_stream" value="1"<!-- IF S_AL_FB_HIDE_STREAM --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_YES}</span>&nbsp;&nbsp;<input type="radio" class="radio" name="al_fb_stream" value="0"<!-- IF not S_AL_FB_HIDE_STREAM --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_NO}</span></td> 
        </tr> 
<!-- ENDIF --> 
<!-- IF AL_FB_FACEPILE --> 
        <tr> 
            <td class="row1" width="50%"><b class="genmed">{L_AL_FB_HIDE_FACEPILE}:</b></td> 
            <td class="row2"><input type="radio" class="radio" name="al_fb_facepile" value="1"<!-- IF S_AL_FB_HIDE_FACEPILE --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_YES}</span>&nbsp;&nbsp;<input type="radio" class="radio" name="al_fb_facepile" value="0"<!-- IF not S_AL_FB_HIDE_FACEPILE --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_NO}</span></td> 
        </tr> 
<!-- ENDIF -->
<!-- IF AL_FB_LIKE_BOX --> 
        <tr> 
            <td class="row1" width="50%"><b class="genmed">{L_AL_FB_HIDE_LIKE_BOX}:</b></td> 
            <td class="row2"><input type="radio" class="radio" name="al_fb_like_box" value="1"<!-- IF S_AL_FB_HIDE_LIKE_BOX --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_YES}</span>&nbsp;&nbsp;<input type="radio" class="radio" name="al_fb_like_box" value="0"<!-- IF not S_AL_FB_HIDE_LIKE_BOX --> checked="checked"<!-- ENDIF --> /><span class="genmed">{L_NO}</span></td> 
        </tr> 
<!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/ucp_profile_avatar.html"> 
			<edit> 
				<find><![CDATA[<!-- IF S_UPLOAD_AVATAR_FILE -->]]></find> 
				<action type="before-add"><![CDATA[        <!-- IF AL_FB_USER --> 
<dl> 
            <dt><label for="fb_avatar">{L_FB_AVATAR}</label><br /><span>{L_FB_AVATAR_EXPLAIN}</span></dt> 
            <dd><input type="checkbox" name="fb_avatar" id="fb_avatar" {FB_AVATAR} /></dd> 
        </dl> 
        <!-- ENDIF --> 
        <!-- IF AL_WL_USER --> 
        <dl> 
            <dt><label for="wl_avatar">{L_WL_AVATAR}</label><br /><span>{L_WL_AVATAR_EXPLAIN}</span></dt> 
            <dd><input type="checkbox" name="wl_avatar" id="wl_avatar" {WL_AVATAR} /></dd> 
        </dl> 
        <!-- ENDIF --> 
        <!-- IF AL_TW_USER --> 
        <dl> 
            <dt><label for="tw_avatar">{L_TW_AVATAR}</label><br /><span>{L_TW_AVATAR_EXPLAIN}</span></dt> 
            <dd><input type="checkbox" name="tw_avatar" id="tw_avatar" {TW_AVATAR} /></dd> 
        </dl> 
        <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/ucp_profile_profile_info.html"> 
			<edit> 
				<find><![CDATA[<!-- INCLUDE ucp_header.html -->]]></find> 
				<action type="after-add"><![CDATA[<script> 
    function apply_fb_data()
    {
        var v_website       = '{FB_WEBSITE}';
        var v_location      = '{FB_LOCATION}';
        var v_occupation    = '{FB_OCCUPATION}';
 
        if(document.getElementById('fb_sync').checked)
        {
            document.getElementById('website').value = v_website;
            document.getElementById('location').value = v_location;
            document.getElementById('occupation').value = v_occupation;
        }
    }
    function apply_wl_data()
    {
        
        var v_location      = '{WL_LOCATION}';
        var v_occupation    = '{WL_OCCUPATION}';
        
        if(document.getElementById('wl_sync').checked)
        {
            
            document.getElementById('location').value = v_location;
            document.getElementById('occupation').value = v_occupation;
        }
    }
    function apply_tw_data()
    {
        
        var v_location      = '{TW_LOCATION}';
        var v_website    = '{TW_WEBSITE}';
        
        if(document.getElementById('tw_sync').checked)
        {
            
            document.getElementById('location').value = v_location;
            document.getElementById('website').value = v_website;
        }
    }
</script>]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[<tr> 
	<td class="row1" colspan="2"><span class="gensmall">{L_PROFILE_INFO_NOTICE}</span></td> 
</tr>]]></find> 
				<action type="after-add"><![CDATA[<!-- IF AL_FB_USER --> 
<tr> 
	<td class="row1" width="35%"><b class="genmed">{L_FB_SYNC}: </b></td> 
	<td class="row2"><input class="post" type="checkbox" name="fb_sync" id="fb_sync" onclick="apply_fb_data();" {FB_SYNC}/></td> 
</tr> 
<!-- ENDIF --> 
<!-- IF AL_WL_USER --> 
<tr> 
	<td class="row1" width="35%"><b class="genmed">{L_WL_SYNC}: </b></td> 
	<td class="row2"><input class="post" type="checkbox" name="wl_sync" id="wl_sync" onclick="apply_wl_data();" {WL_SYNC}/></td> 
</tr> 
<!-- ENDIF --> 
<!-- IF AL_TW_USER --> 
<tr> 
	<td class="row1" width="35%"><b class="genmed">{L_TW_SYNC}: </b></td> 
	<td class="row2"><input class="post" type="checkbox" name="tw_sync" id="tw_sync" onclick="apply_tw_data();" {TW_SYNC}/></td> 
</tr> 
<!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/ucp_profile_signature.html"> 
			<edit> 
				<find><![CDATA[<!-- INCLUDE ucp_header.html -->]]></find> 
				<action type="after-add"><![CDATA[<script> 
    var fb_status = "{S_FB_STATUS}";
 
    function apply_fb_status()
    {
        document.getElementsByName('signature')[0].innerHTML = fb_status;
    }
 
    var wl_status = "{S_WL_STATUS}";
 
    function apply_wl_status()
    {
        document.getElementsByName('signature')[0].innerHTML = wl_status;
    }
    
    var tw_status = "{S_TW_STATUS}";
 
    function apply_tw_status()
    {
        document.getElementsByName('signature')[0].innerHTML = tw_status;
    }
</script>]]></action> 
			</edit> 
			<edit> 
				<find><![CDATA[<!-- IF S_BBCODE_ALLOWED -->]]></find> 
				<action type="before-add"><![CDATA[                <!-- IF AL_FB_USER --> 
                        <tr> 
				<td><input type="checkbox" class="radio" name="fb_status" onclick="apply_fb_status();" {S_FB_STATUS_CHECKED} /></td> 
				<td class="gen">{L_FB_STATUS}</td> 
			</tr> 
                <!-- ENDIF --> 
                <!-- IF AL_WL_USER --> 
                        <tr> 
				<td><input type="checkbox" class="radio" name="wl_status" onclick="apply_wl_status();" {S_WL_STATUS_CHECKED} /></td> 
				<td class="gen">{L_WL_STATUS}</td> 
			</tr> 
                <!-- ENDIF --> 
                <!-- IF AL_TW_USER --> 
                        <tr> 
				<td><input type="checkbox" class="radio" name="tw_status" onclick="apply_tw_status();" {S_TW_STATUS_CHECKED} /></td> 
				<td class="gen">{L_TW_STATUS}</td> 
			</tr> 
                <!-- ENDIF -->]]></action> 
			</edit> 
		</open> 
		<open src="styles/subsilver2/template/ucp_register.html"> 
			<edit> 
				<find><![CDATA[<form name="register" method="post" action="{S_UCP_ACTION}">]]></find> 
				<action type="before-add"><![CDATA[<!-- IF (S_AL_WL_ENABLED or S_AL_FB_ENABLED or S_AL_TW_ENABLED or S_AL_OI_ENABLED) and not S_ADMIN_AUTH -->
 <div class="panel bg3">
   <div class="inner"><span class="corners-top"><span></span></span>
      
 <h3>{L_SOCIAL_LOGIN_OPTIONS}</h3> 
                <br /> 
            <!-- IF S_AL_WL_ENABLED --> 
            <a href="{U_AL_WL_AUTHORIZE}"><img src="alternatelogin/images/windows_live_connect.png" alt="Windows Live" /></a> 
        <!-- ENDIF --> 
 
        <!-- IF S_AL_FB_ENABLED --> 
            <a onclick="window.location='alternatelogin/al_fb_connect.php';" href="#"> 
                    <img src="http://static.ak.fbcdn.net/images/fbconnect/login-buttons/connect_light_medium_long.gif" alt="Login with your Facebook account!" /> 
            </a> 
        <!-- ENDIF --> 
      <!-- IF S_AL_TW_ENABLED --> 
        <a href="{U_AL_TW_REQUEST}"><img src="alternatelogin/images/sign-in-with-twitter-l.png" alt="Twitter" /></a> 
        <!-- ENDIF --> 
        
        <!-- IF S_AL_OI_ENABLED --> 
        <link type="text/css" rel="stylesheet" href="{T_TEMPLATE_PATH}/css/openid.css" />
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/jquery-1.2.6.min.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-jquery.js"></script>
	<script type="text/javascript" src="{T_TEMPLATE_PATH}/js/openid-en.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			openid.init('openid_identifier');
			
		});
	</script>
        <form action="{U_AL_OI_LOGIN}" method="get" id="openid_form">
		<input type="hidden" name="action" value="verify" />
		<fieldset>
			
			<div id="openid_choice">
				
				<div id="openid_btns"></div>
			</div>
			<div id="openid_input_area">
				<input id="openid_identifier" name="openid_identifier" type="text" value="http://" />
				<input id="openid_submit" type="submit" value="Sign-In"/>
			</div>
			
		</fieldset>
	</form>
        <!-- ENDIF --> 
      

   <span class="corners-bottom"><span></span></span></div>
</div>
 <!-- ENDIF -->]]></action> 
			</edit> 
			
		</open> 
		<open src="styles/subsilver2/template/viewtopic_body.html"> 
			<edit> 
				<find><![CDATA[<h2><a class="titles" href="{U_VIEW_TOPIC}">{TOPIC_TITLE}</a></h2>]]></find> 
				<action type="after-add"><![CDATA[&nbsp;&nbsp;<fb:like href="{U_PAGE_URL}" show_faces="false" width="450" font="arial"></fb:like>]]></action> 
			</edit> 
		</open> 
		<php-installer><![CDATA[alternatelogin_mod_install.php]]></php-installer> 
		<diy-instructions lang="en"><![CDATA[The following instructions assume that you have correctly copied all the files across, completed all the file edits, added and altered as necessary and setup the UCP and ACP pages as defined in the install_mod.xml MODX file and the alternatelogin_mod_install.php UMIL file.

The following is dividing into sections, each section refers to a specific provider. Each provider acts independently of the others, you don't need to setup Windows Live to use Facebook, for example.

-- Facebook --

The first thing you need to do is head over to the Facebook Developers Site. Here you can create a new Application. Facebook requires you to create an Application to use their login authentication utilities.

NOTE: You may need to go through some form of authentication, such as receiving a confirm code by SMS text message and entering it into their site before you can create an Application. This is usually only required for your first App.

Follow the on screen instructions and fill out the required fields.

Once you have finished creating your Application, you will need 2 pieces of information.

*App ID/API Key
*App Secret

On your phpBB forum, login as an Administrator and go to Administration Control Panel->ConSof->Facebook Manager. Fill in the fields with the information you acquired when you created your Application.

NOTE: The Site Domain should not include any trailing '/' characters or directories and should not include 'http://' or 'https://

Once you have completed the fields you can choose which Facebook plugins you wish to enable. These will appear on the index page of the forum only.

*Facebook Activity - This will show the most and recent and frequently 'liked' pages.
*Facebook Facepile - This shows the Facebook Profile Pictures of the users who have 'liked' the page and the friends who have signed up.
*Facebook Stream - This is a form of Instant Chat service that allows Facebook users to leave messages and discussions.

Finally, click Submit.

Now you can return to the main Alternate Login Manager page and enable Facebook Login.


-- Windows Live --

Go to the Windows Live Developers Site and sign in or sign up as needed. Create you application via following the on screen instructions.

Once your application is created you will need 2 pieces of information from Windows:

*Client ID
*Client Secret

Go to the Administration Control Panel->ConSof->Windows Live Manager. Fill in the fields as below. The 'Path to callback file' is the full url of the 'al_wl_connect.php' file.

Finally, click Submit.

Once this is complete you can enable the Windows Live login on the main Alternate Login Manager page.


-- Twitter --

Go to the Twitter Developers Site and sign up or sign in and follow the instructions for creating an Application.

You will require 3 pieces of information from the Twitter Application:

*Consumer Key
*Consumer Secret
*Callback URL - Must point to you al_tw_connect.php file.

Enter the data in the Twitter Manager page and fill in the fields.

Finally, click Submit.

Once this is complete you can enable the Windows Live login on the main Alternate Login Manager page.]]></diy-instructions> 
	</action-group> 
</mod> 